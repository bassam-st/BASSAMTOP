!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Bassam Core</title>
  <link rel="stylesheet" href="/static/style.css"/>
</head>
<body>
  <div class="container">
    <header>
      <h1>Bassam Core <span>ğŸ§ </span></h1>
      <div class="badge {{ 'active' if state.get('active') else 'inactive' }}">
        Ø§Ù„Ø­Ø§Ù„Ø©: {{ 'Ù†Ø´Ø·' if state.get('active') else 'ØºÙŠØ± Ù†Ø´Ø·' }}
      </div>
      <nav>
        <a href="/docs" target="_blank">Swagger</a>
        <a href="/api/state" target="_blank">/api/state</a>
      </nav>
    </header>

    <section class="controls">
      <form id="searchForm" onsubmit="return runOnce(event)">
        <input id="q" name="q" placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø¨Ø­Ø«..." />
        <button type="submit">Ø¨Ø­Ø« ÙÙˆØ±ÙŠ + ØªØ¹Ù„Ù‘Ù…</button>
      </form>

      <form id="queueForm" onsubmit="return enqueue(event)">
        <input id="qq" name="q" placeholder="Ø£Ø¶Ù Ù„Ù„ØµÙ (ÙŠÙÙ†ÙØ° ÙƒÙ„ 30 Ø¯Ù‚ÙŠÙ‚Ø©)" />
        <button type="submit">Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØµÙ</button>
      </form>

      <p class="hint">Ø§Ù„ÙˆØ¶Ø¹: Ø§Ù„ÙˆÙŠØ¨ ÙÙ‚Ø· ÙŠØ¹Ø±Ø¶/ÙŠÙØ´ØºÙ‘ÙÙ„ Ø¯ÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§. Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø¯ÙˆØ±ÙŠ ÙŠØ¹Ù…Ù„ ÙÙŠ Ø®Ø¯Ù…Ø© Worker.</p>
    </section>

    <section>
      <h2>Ø¢Ø®Ø± Ø§Ù„Ù…Ù„Ø®ØµØ§Øª</h2>
      {% if recents %}
        {% for s in recents %}
          <article class="card">
            <h3>ğŸ“ {{ s.get('query','(Ø¨Ø¯ÙˆÙ† Ø§Ø³ØªØ¹Ù„Ø§Ù…)') }}</h3>
            <pre>{{ s.get('summary','') }}</pre>
            <details>
              <summary>Ø§Ù„Ù…ØµØ§Ø¯Ø±</summary>
              <ul>
                {% for it in s.get('items',[]) %}
                  <li><a href="{{ it.get('url') }}" target="_blank">{{ it.get('title') }}</a></li>
                {% endfor %}
              </ul>
            </details>
          </article>
        {% endfor %}
      {% else %}
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø®ØµØ§Øª Ø¨Ø¹Ø¯.</p>
      {% endif %}
    </section>
  </div>

<script>
async function runOnce(e){
  e.preventDefault();
  const q = document.getElementById('q').value.trim();
  const r = await fetch('/api/learn/once?q='+encodeURIComponent(q), {method:'POST'});
  const j = await r.json();
  alert('ØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„: ' + (j.ok ? 'Ù†Ø¬Ø§Ø­' : 'ÙØ´Ù„'));
  location.reload();
  return false;
}
async function enqueue(e){
  e.preventDefault();
  const q = document.getElementById('qq').value.trim();
  const r = await fetch('/api/queue?q='+encodeURIComponent(q), {method:'POST'});
  const j = await r.json();
  alert('Ø£ÙØ¶ÙŠÙ Ù„Ù„ØµÙ: ' + q);
  return false;
}
</script>
</body>
</html>
