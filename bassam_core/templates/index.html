<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Bassam Core</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  {# Ù…Ù„Ù Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ static/style.css #}
  <link rel="stylesheet" href="{{ request.url_for('static', path='style.css') }}">

  {# Ù…Ù„ÙØ§Øª Ø§Ù„Ù€ PWA Ù„Ùˆ ØªØ³ØªØ®Ø¯Ù…Ù‡Ø§ #}
  <link rel="manifest" href="{{ request.url_for('static', path='manifest.json') }}">
</head>
<body style="background:#020617; margin:0; font-family: system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;">

  <main style="min-height:100vh; display:flex; align-items:flex-start; justify-content:center; padding:2rem 1rem;">
    <section style="width:100%; max-width:900px;">

      <!-- Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
      <div style="
        background:#020617;
        border-radius:1rem;
        padding:1.25rem 1.5rem;
        border:1px solid #1f2937;
        color:#e5e7eb;
        box-shadow:0 10px 25px rgba(0,0,0,0.4);
      ">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header style="
          display:flex;
          flex-wrap:wrap;
          align-items:center;
          justify-content:space-between;
          gap:.75rem;
          margin-bottom:1rem;
        ">
          <div style="display:flex; align-items:center; gap:.5rem; flex-wrap:wrap;">
            <div style="
              width:28px; height:28px;
              border-radius:999px;
              background:radial-gradient(circle at 30% 20%, #f97316, #ec4899 45%, #6366f1);
              display:flex; align-items:center; justify-content:center;
              box-shadow:0 5px 15px rgba(129,140,248,.6);
            ">
              <span style="font-size:1.1rem;">ğŸ§ </span>
            </div>
            <div>
              <div style="font-weight:600; font-size:.98rem;">Bassam Core</div>
              <div style="font-size:.75rem; color:#9ca3af;">
                Ø§Ù„Ø­Ø§Ù„Ø©: <span id="engine-status" style="color:#f97316;">ØºÙŠØ± Ù†Ø´Ø· ÙÙ‚Ø·</span>
              </div>
            </div>
          </div>

          <div style="display:flex; flex-wrap:wrap; gap:.5rem; font-size:.75rem;">
            <a href="/docs" style="color:#60a5fa; text-decoration:none;">Swagger</a>
            <span style="opacity:.4;">/</span>
            <a href="/api/news" style="color:#60a5fa; text-decoration:none;">/api/news</a>
          </div>
        </header>

        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ + Ø­Ù‚Ù„ Ø§Ù„Ù†Øµ -->
        <div style="display:flex; flex-wrap:wrap; gap:.5rem; margin-bottom:.75rem;">
          <select id="engine-select" style="
            background:#020617;
            color:#e5e7eb;
            border-radius:.5rem;
            border:1px solid #374151;
            padding:.4rem .6rem;
            font-size:.8rem;
          ">
            <option value="auto">Auto (Google + DDG)</option>
            <option value="google">Google ÙÙ‚Ø·</option>
            <option value="ddg">DuckDuckGo ÙÙ‚Ø·</option>
            <option value="none">Ø¨Ø¯ÙˆÙ† Ø¨Ø­Ø« Ø®Ø§Ø±Ø¬ÙŠ</option>
          </select>

          <input id="query-input" type="text" placeholder="Ø§ÙƒØªØ¨ Ù…ÙˆØ¶ÙˆØ¹Ù‹Ø§â€¦ Ù…Ø«Ø§Ù„: Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…"
            style="
              flex:1 1 180px;
              min-width:0;
              background:#020617;
              color:#e5e7eb;
              border-radius:.5rem;
              border:1px solid #374151;
              padding:.45rem .7rem;
              font-size:.85rem;
              outline:none;
            "
          />
        </div>

        <!-- ÙˆØµÙ Ù‚ØµÙŠØ± -->
        <p style="margin:0 0 .75rem; font-size:.75rem; color:#9ca3af;">
          Ø§Ù„Ø£ÙˆÙ„: ÙŠØ¨Ø­Ø« Ø§Ù„Ø¢Ù† ÙˆÙŠÙÙƒØ± ÙˆÙŠØ¹Ø±Ø¶ØŒ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø¨Ø­Ø« ÙÙˆØ±ÙŠ Ù…Ø¹ ØªÙ„Ø®ÙŠØµØŒ Ø§Ù„Ø«Ø§Ù„Ø«: Ø¨Ø­Ø« ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† ØªØ¹Ù„ÙŠÙ….
        </p>

        <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
        <div style="display:flex; flex-wrap:wrap; gap:.5rem;">
          <button id="btn-search-teach" type="button" style="
            background:#111827;
            color:#e5e7eb;
            border-radius:.5rem;
            border:1px solid #374151;
            padding:.4rem .75rem;
            font-size:.78rem;
            cursor:pointer;
          ">
            Ø¨Ø­Ø« (ØµÙÙ‡ + ØªÙ„Ø®ÙŠØµ)
          </button>

          <button id="btn-search-quick-teach" type="button" style="
            background:#111827;
            color:#e5e7eb;
            border-radius:.5rem;
            border:1px solid #374151;
            padding:.4rem .75rem;
            font-size:.78rem;
            cursor:pointer;
          ">
            Ø¨Ø­Ø« ÙÙˆØ±ÙŠ + ØªÙ„Ø®ÙŠØµ
          </button>

          <button id="btn-search-only" type="button" style="
            background:#111827;
            color:#e5e7eb;
            border-radius:.5rem;
            border:1px solid #374151;
            padding:.4rem .75rem;
            font-size:.78rem;
            cursor:pointer;
          ">
            Ø¨Ø­Ø« (ØµÙÙ‡ ÙÙ‚Ø·)
          </button>
        </div>
      </div>

      <!-- Ù…ÙƒØ§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
      <section style="
        margin-top:1.25rem;
        background:#020617;
        border-radius:1rem;
        padding:1rem 1.25rem;
        border:1px solid #1f2937;
        color:#e5e7eb;
        min-height:140px;
        white-space:pre-wrap;
        font-size:.9rem;
      " id="result-box">
        Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ ÙˆØ§Ø¶ØºØ· Ø£Ø­Ø¯ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¨Ø­Ø«â€¦
      </section>

    </section>
  </main>

  <!-- Ø³ÙƒØ±Ø¨Øª Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ±Ø¨Ø·Ù‡Ø§ Ù…Ø¹ /api/news -->
  <script>
    async function runSearch(mode) {
      const input = document.getElementById('query-input');
      const engineSelect = document.getElementById('engine-select');
      const resultBox = document.getElementById('result-box');

      const query = (input.value || '').trim();
      const engine = engineSelect.value || 'auto';

      if (!query) {
        resultBox.textContent = 'Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ù…ÙˆØ¶ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¨Ø­Ø«.';
        input.focus();
        return;
      }

      resultBox.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªÙÙƒÙŠØ±â€¦';

      try {
        const response = await fetch('/api/news', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: query,
            engine: engine,
            mode: mode   // Ù…Ø«Ù„: search_and_learn / quick_search_and_learn / search_only
          })
        });

        const contentType = response.headers.get('content-type') || '';

        if (!response.ok) {
          const text = await response.text();
          resultBox.textContent = 'Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (' + response.status + '):\n' + text;
          return;
        }

        if (contentType.includes('application/json')) {
          const data = await response.json();
          const answer =
            data.answer ||
            data.result ||
            data.summary ||
            JSON.stringify(data, null, 2);

          resultBox.textContent = answer;
        } else {
          const text = await response.text();
          resultBox.textContent = text;
        }
      } catch (err) {
        console.error(err);
        resultBox.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Render.';
      }
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    document.getElementById('btn-search-teach')
      .addEventListener('click', function () {
        runSearch('search_and_learn');
      });

    document.getElementById('btn-search-quick-teach')
      .addEventListener('click', function () {
        runSearch('quick_search_and_learn');
      });

    document.getElementById('btn-search-only')
      .addEventListener('click', function () {
        runSearch('search_only');
      });

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø²Ø± Enter
    document.getElementById('query-input')
      .addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          runSearch('search_and_learn');
        }
      });
  </script>
</body>
</html>
